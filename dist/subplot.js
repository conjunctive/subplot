!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).subplot=e()}}(function(){function e(e){if("string"!=typeof e||""===e)throw TypeError("Invalid message type");Object.defineProperty(this,"type",{enumerable:!0,configurable:!1,value:e})}function t(t){e.call(this,t)}function o(t){e.call(this,t)}function r(e){if(!(this instanceof r))return new r(e);if(void 0!==e&&"object"!=typeof e)throw TypeError("Invalid payload");t.call(this,"connection_init"),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!1,value:e||{}})}function n(e,o,r,i){if(!(this instanceof n))return new n(e,o,r,i);if("string"!=typeof e||""===e)throw TypeError("Invalid operation identifier");if("string"!=typeof o||""===o)throw TypeError("Invalid query");if(void 0!==r&&"object"!=typeof r)throw TypeError("Invalid payload");if(void 0!==i&&"string"!=typeof i)throw TypeError("Invalid operation name");t.call(this,"start"),Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,value:e}),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!1,value:{query:o,variables:r||{},operationName:i||""}})}function i(e){if(!(this instanceof i))return new i(e);if("string"!=typeof e||""===e)throw TypeError("Invalid operation identifier");t.call(this,"stop"),Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,value:e})}function a(){if(!(this instanceof a))return new a;t.call(this,"connection_terminate")}function c(e){if(!(this instanceof c))return new c(e);o.call(this,"connection_error"),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!1,value:e})}function s(){if(!(this instanceof e))return new e;o.call(this,"connection_ack")}function p(e,t){if(!(this instanceof p))return new p(e,t);o.call(this,"data"),Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,value:e}),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!1,value:t})}function f(e,t){if(!(this instanceof f))return new f(e,t);o.call(this,"error"),Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,value:e}),Object.defineProperty(this,"payload",{enumerable:!0,configurable:!1,value:t})}function u(e){if(!(this instanceof u))return new u(e);o.call(this,"complete"),Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,value:e})}function l(e){switch(e.readyState){case 0:throw Error("WebSocket connection is in the process of connecting");case 1:return e;case 2:throw Error("WebSocket connection is in the process of closing");case 3:throw Error("WebSocket connection is closed");default:throw TypeError("WebSocket is in unknown state")}}return e.prototype.toString=function(){return"[object OperationMessage]"},t.prototype=Object.create(e.prototype),t.prototype.toString=function(){return"[object OperationMessageFromClient]"},o.prototype=Object.create(e.prototype),o.prototype.toString=function(){return"[object OperationMessageFromServer]"},r.prototype=Object.create(t.prototype),r.prototype.toString=function(){return"[object InitMessage]"},n.prototype=Object.create(t.prototype),n.prototype.toString=function(){return"[object StartMessage]"},i.prototype=Object.create(t.prototype),i.prototype.toString=function(){return"[object StopMessage]"},a.prototype=Object.create(t.prototype),a.prototype.toString=function(){return"[object ConnectionTerminateMessage]"},c.prototype=Object.create(o.prototype),c.prototype.toString=function(){return"[object ConnectionErrorMessage]"},s.prototype=Object.create(o.prototype),s.prototype.toString=function(){return"[object ConnectionAckMessage]"},p.prototype=Object.create(o.prototype),p.prototype.toString=function(){return"[object DataMessage]"},f.prototype=Object.create(o.prototype),f.prototype.toString=function(){return"[object ErrorMessage]"},u.prototype=Object.create(o.prototype),u.prototype.toString=function(){return"[object CompleteMessage]"},{OperationMessage:e,OperationMessageFromClient:t,OperationMessageFromServer:o,InitMessage:r,StartMessage:n,StopMessage:i,ConnectionTerminateMessage:a,ConnectionErrorMessage:c,ConnectionAckMessage:s,DataMessage:p,ErrorMessage:f,CompleteMessage:u,ensureOpen:l,send:function(e,o){if(!(o instanceof t))throw TypeError("Invalid message");try{var r=JSON.stringify(o,null,0)}catch(n){throw Error("Unable to serialize message")}l(e).send(r)},receive:function(e){switch(e.type){case"connection_error":return new c(e.payload);case"connection_ack":return new s;case"data":return new p(e.id,e.payload);case"error":return new f(e.id,e.payload);case"complete":return new u(e.id);default:throw TypeError("Received message of unknown type\n"+JSON.stringify(e,null,2))}}}});